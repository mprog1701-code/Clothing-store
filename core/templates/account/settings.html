{% extends 'base.html' %}

{% block title %}حسابي{% endblock %}

{% block content %}
<div class="account-page">
  <div class="account-card">
<div class="container py-4 account-settings">
  <div class="settings-container">
    <div class="card bg-white text-dark shadow-sm mb-3">
        <div class="card-body settings-card-body">
            <div class="d-flex align-items-center justify-content-between">
                <div class="d-flex align-items-center gap-3">
                    <i class="bi bi-person fs-4"></i>
                    <div>
                        <div class="fw-bold" data-i18n="account_login">الدخول أو انشاء حساب جديد</div>
                        {% if user.is_authenticated %}
                            <small class="text-muted">{{ user.username }}</small>
                        {% else %}
                            <small class="text-muted" data-i18n="account_not_signed">غير مسجل</small>
                        {% endif %}
                    </div>
                </div>
                {% if user.is_authenticated %}
                    <a href="{% url 'logout' %}" class="btn btn-outline-secondary btn-sm" data-i18n="account_logout">تسجيل الخروج</a>
                {% else %}
                    <div class="d-flex gap-2">
                        <a href="{% url 'login' %}" class="btn btn-outline-primary btn-sm" data-i18n="account_login">تسجيل الدخول</a>
                        <a href="{% url 'register' %}" class="btn btn-primary btn-sm" data-i18n="account_register">تسجيل</a>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
    
    <div class="list-group settings-list">
        <a href="#" id="langItem" class="list-group-item list-group-item-action d-flex align-items-center justify-content-between settings-row">
            <div class="d-flex align-items-center gap-3">
                <i class="bi bi-translate fs-5"></i>
                <div>
                    <div class="fw-bold" data-i18n="account_language">اللغة</div>
                    <small class="text-muted" id="currentLanguage">العربية</small>
                </div>
            </div>
            <i class="bi bi-chevron-left"></i>
        </a>
        <a href="#" id="themeItem" class="list-group-item list-group-item-action d-flex align-items-center justify-content-between settings-row">
            <div class="d-flex align-items-center gap-3">
                <i class="bi bi-brightness-high fs-5"></i>
                <div>
                    <div class="fw-bold" data-i18n="account_theme">مظهر التطبيق</div>
                    <small class="text-muted" id="currentTheme">داكن</small>
                </div>
            </div>
            <i class="bi bi-chevron-left"></i>
        </a>
        <a href="#" onclick="openAnnouncements();return false;" class="list-group-item list-group-item-action d-flex align-items-center justify-content-between settings-row">
            <div class="d-flex align-items-center gap-3">
                <i class="bi bi-bell fs-5"></i>
                <div class="fw-bold" data-i18n="account_notifications">الاشعارات</div>
            </div>
            <i class="bi bi-chevron-left"></i>
        </a>
        <a href="{% url 'services' %}" class="list-group-item list-group-item-action d-flex align-items-center justify-content-between settings-row">
            <div class="d-flex align-items-center gap-3">
                <i class="bi bi-chat-dots fs-5"></i>
                <div class="fw-bold" data-i18n="account_services">خدماتنا</div>
            </div>
            <i class="bi bi-chevron-left"></i>
        </a>
        <a href="{% url 'about' %}" class="list-group-item list-group-item-action d-flex align-items-center justify-content-between settings-row">
            <div class="d-flex align-items-center gap-3">
                <i class="bi bi-info-circle fs-5"></i>
                <div class="fw-bold" data-i18n="account_about">عن شركتنا</div>
            </div>
            <i class="bi bi-chevron-left"></i>
        </a>
        
        <a href="#" class="list-group-item d-flex align-items-center justify-content-between disabled settings-row" style="pointer-events:none; opacity:0.6;">
            <div class="d-flex align-items-center gap-3">
                <i class="bi bi-app fs-5"></i>
                <div class="fw-bold" data-i18n="account_appicon">ايقونة التطبيق</div>
            </div>
            <i class="bi bi-lock"></i>
        </a>
    </div>
  </div>
  </div>
</div>
</div>

<div class="modal fade" id="languageModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-body">
        <div class="list-group">
          <a href="#" class="list-group-item list-group-item-action" data-lang="ar">العربية</a>
          <a href="#" class="list-group-item list-group-item-action" data-lang="en">English</a>
          <a href="#" class="list-group-item list-group-item-action" data-lang="ku">کوردی</a>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
.account-page { 
  min-height: 100vh; 
  display: flex; 
  justify-content: center; 
  padding: 1rem 0.75rem; 
}

.account-card { 
  width: 100%; 
  max-width: 480px; 
}

@media (min-width: 768px) { 
  .account-page { 
    padding: 2rem 1.5rem; 
  } 

  .account-card { 
    max-width: 720px; 
  } 
}

@media (min-width: 1200px) { 
  .account-page { 
    padding: 3rem 0; 
  } 

  .account-card { 
    max-width: 960px; 
  } 
}
.account-settings { padding-bottom: 12px; }
.account-settings .settings-container { width: 100%; max-width: 420px; margin: 0 auto; padding: 0 8px; }
.account-settings .settings-card-body { padding: 18px; }
.account-settings .card { margin: 0 auto 12px; border-radius: 14px; }
.account-settings .settings-list { margin: 0; }
.account-settings .settings-row { min-height: 56px; padding: 10px 12px; }
.account-settings .d-flex.gap-2 a.btn { flex: 1 1 0; min-width: 0; }
@media (max-width: 600px){
  .account-settings .settings-card-body { padding: 20px; }
}
@media (max-width: 480px){
  .account-settings .settings-container { padding: 0 8px; }
  .account-settings .card { border-radius: 12px; }
  .account-settings .settings-row { padding: 10px 12px; }
}
@media (max-width: 400px){
  .account-settings .settings-row { min-height: 54px; }
}
</style>
<script>
function initAccountSettings(){
  const langItem=document.getElementById('langItem');
  const currentLanguage=document.getElementById('currentLanguage');
  const themeItem=document.getElementById('themeItem');
  const currentTheme=document.getElementById('currentTheme');
  function applyLanguageLabel(){
    let lang='ar';
    try{
      const stored=localStorage.getItem('siteLanguage');
      lang = (stored && window.i18n && window.i18n[stored]) ? stored : 'ar';
      if(!stored){ localStorage.setItem('siteLanguage','ar'); }
    }catch(e){ lang='ar'; }
    const dict=(window.i18n && window.i18n[lang])? window.i18n[lang] : window.i18n['ar'];
    if(currentLanguage) currentLanguage.textContent = dict['language_'+lang] || dict.language_ar;
  }
  function applyTheme(){
    const theme=localStorage.getItem('siteTheme')||'dark';
    const lang=localStorage.getItem('siteLanguage')||'ar';
    const dict=(window.i18n && window.i18n[lang])? window.i18n[lang] : window.i18n['ar'];
    if(currentTheme) currentTheme.textContent = theme==='dark'? dict.theme_dark : dict.theme_light;
    document.body.classList.toggle('theme-light', theme==='light');
  }
  applyLanguageLabel();
  applyTheme();
  if(langItem){
    langItem.addEventListener('click',function(e){
      e.preventDefault();
      const modalEl=document.getElementById('languageModal');
      if(window.bootstrap && modalEl){
        try{ new bootstrap.Modal(modalEl).show(); }catch(err){}
      } else {
        const order=['ar','en','ku'];
        let current = 'ar';
        try{ const stored=localStorage.getItem('siteLanguage'); if(stored) current=stored; }catch(err){}
        const next = order[(order.indexOf(current)+1)%order.length];
        try{ localStorage.setItem('siteLanguage', next); }catch(err){}
        applyLanguageLabel();
        window.dispatchEvent(new CustomEvent('languageChange',{detail:{lang:next}}));
      }
    });
  }
  document.querySelectorAll('#languageModal .list-group-item').forEach(el=>{
    el.addEventListener('click',function(e){
      e.preventDefault();
      const lang=this.getAttribute('data-lang');
      try{ localStorage.setItem('siteLanguage',lang); }catch(err){}
      applyLanguageLabel();
      window.dispatchEvent(new CustomEvent('languageChange',{detail:{lang}}));
      const modalEl=document.getElementById('languageModal');
      if(window.bootstrap && modalEl){ try{ bootstrap.Modal.getInstance(modalEl).hide(); }catch(err){} }
    });
  });
  if(themeItem){
    themeItem.addEventListener('click',function(e){
      e.preventDefault();
      const theme=localStorage.getItem('siteTheme')||'dark';
      const newTheme=theme==='dark'?'light':'dark';
      try{ localStorage.setItem('siteTheme',newTheme); }catch(err){}
      applyTheme();
    });
  }
}
if(document.readyState === 'loading'){
  document.addEventListener('DOMContentLoaded', initAccountSettings);
} else {
  initAccountSettings();
}
</script>
{% endblock %}
