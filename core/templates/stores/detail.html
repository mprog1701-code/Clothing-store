{% extends 'base.html' %}
{% load math_filters %}

{% block title %}{{ store.name }} - متجر الملابس{% endblock %}

{% block content %}
<section class="py-5">
  <div class="container store-detail-wrap">
    <div class="mb-4">
      <h1 class="fw-bold">{{ store.name }}</h1>
      <div class="text-muted"><i class="bi bi-geo-alt me-1"></i>{{ store.city }}</div>
    </div>

    <form method="get" class="row g-3 mb-4">
      <div class="col-md-4">
        <select name="category" class="form-select">
          <option value="">جميع الفئات</option>
          {% for key,label in categories %}
          <option value="{{ key }}" {% if key == selected_category %}selected{% endif %}>{{ label }}</option>
          {% endfor %}
        </select>
      </div>
      <div class="col-md-4">
        <select name="size" class="form-select">
          <option value="">جميع القياسات</option>
          {% for s in available_sizes %}
          <option value="{{ s }}" {% if s == selected_size %}selected{% endif %}>{{ s }}</option>
          {% endfor %}
        </select>
      </div>
      <div class="col-md-4">
        <select name="sort" class="form-select">
          <option value="">بدون ترتيب</option>
          <option value="new" {% if selected_sort == 'new' %}selected{% endif %}>الأحدث</option>
          <option value="price_asc" {% if selected_sort == 'price_asc' %}selected{% endif %}>السعر الأقل</option>
          <option value="price_desc" {% if selected_sort == 'price_desc' %}selected{% endif %}>السعر الأعلى</option>
          <option value="most_sold" {% if selected_sort == 'most_sold' %}selected{% endif %}>الأكثر مبيعاً</option>
        </select>
      </div>
      <div class="col-12">
        <button type="submit" class="btn btn-gradient">تطبيق</button>
      </div>
    </form>

    <div class="row g-3 mobile-horizontal-scroll products-scroll">
      {% for p in products %}
      <div class="col-6 col-md-3">
        <a href="{% url 'product_detail' p.id %}" class="card product-card h-100 text-decoration-none">
          <div class="ratio ratio-1x1">
            {% with img=p.images.all|first %}
              {% if img %}
                <img src="{{ img.get_image_url }}" alt="{{ p.name }}" class="card-img-top" onerror="this.onerror=null;this.src='{{ placeholder_image_url }}'">
              {% else %}
                <img src="{{ placeholder_image_url }}" alt="{{ p.name }}" class="card-img-top">
              {% endif %}
            {% endwith %}
          </div>
          <div class="card-body">
            <div class="small text-muted">{{ p.store.name }}</div>
            <div class="fw-semibold">{{ p.name }}</div>
            <div class="text-primary">{{ p.discount_price|default:p.base_price|iqd }}</div>
          </div>
        </a>
      </div>
      {% empty %}
      <div class="col-12">
        <div class="empty-state text-center py-5">
          <div class="empty-icon mb-3">
            <i class="bi bi-box-seam display-4 text-muted opacity-50"></i>
          </div>
          <h5 class="text-muted mb-2">لا توجد منتجات لهذا المتجر</h5>
          <p class="text-muted small">جرّب تغيير الفئة أو القياس</p>
        </div>
      </div>
      {% endfor %}
    </div>
  </div>
</section>
{% endblock %}
