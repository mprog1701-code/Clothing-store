{% extends 'base.html' %}
{% load static %}
{% load math_filters %}

{% block title %}مركز تحكم: {{ store.name }}{% endblock %}

{% block content %}
<div class="container py-4">
  <div class="card border-0 shadow-sm mb-4">
    <div class="card-body d-flex justify-content-between align-items-center">
      <div class="d-flex align-items-center">
        <div class="me-3">
          <img src="{{ store.main_logo_url|default:'' }}" alt="{{ store.name }}" class="rounded-circle" width="64" height="64" style="object-fit:cover" onerror="this.onerror=null;this.src='https://placehold.co/120x120?text=Store'">
        </div>
        <div>
          <h1 class="h4 mb-1">{{ store.name }}</h1>
          <div class="text-muted">
            <i class="bi bi-geo-alt me-1"></i>{{ store.city }}
            <span class="mx-2">•</span>
            {{ store.get_category_display }}
          </div>
        </div>
      </div>
      <div class="d-flex align-items-center gap-2">
        {% if store.is_active %}
          <span class="badge bg-success">نشط</span>
        {% else %}
          <span class="badge bg-danger">موقوف</span>
        {% endif %}
        <a href="{% url 'super_owner_stores' %}" class="btn btn-outline-secondary">
          <i class="fas fa-arrow-left me-1"></i>
          العودة للمتاجر
        </a>
      </div>
    </div>
  </div>

  <div class="row g-3 mb-4">
    <div class="col-md-6">
      <div class="card border-0 shadow-sm">
        <div class="card-body text-center">
          <div class="fw-bold fs-3" aria-label="عدد المنتجات">{{ products_count }}</div>
          <div class="text-muted">عدد المنتجات</div>
        </div>
      </div>
    </div>
    <div class="col-md-6">
      <div class="card border-0 shadow-sm">
        <div class="card-body text-center">
          <div class="fw-bold fs-3" aria-label="طلبات اليوم">{{ orders_today }}</div>
          <div class="text-muted">طلبات اليوم</div>
        </div>
      </div>
    </div>
  </div>

  <div class="card border-0 shadow-sm mb-4">
    <div class="card-body d-flex flex-wrap gap-2">
      <a href="{% url 'super_owner_store_settings' store.id %}" class="btn btn-primary">
        <i class="fas fa-edit me-1"></i> تعديل المتجر
      </a>
      <a href="{% url 'super_owner_add_product' %}?store={{ store.id }}" class="btn btn-secondary">
        <i class="fas fa-boxes me-1"></i> إدارة المنتجات
      </a>
      <a href="{% url 'super_owner_orders' %}?store={{ store.id }}" class="btn btn-info">
        <i class="fas fa-list me-1"></i> إدارة الطلبات
      </a>
      <form method="post" class="d-inline">
        {% csrf_token %}
        {% if store.is_active %}
          <button name="action" value="deactivate" class="btn btn-warning"><i class="fas fa-pause me-1"></i> تعطيل</button>
        {% else %}
          <button name="action" value="activate" class="btn btn-success"><i class="fas fa-play me-1"></i> تفعيل</button>
        {% endif %}
      </form>
      <a href="{% url 'super_owner_stores' %}" class="btn btn-outline-secondary">
        <i class="fas fa-arrow-left me-1"></i> العودة للمتاجر
      </a>
    </div>
  </div>

  <div class="card border-0 shadow-sm">
    <div class="card-header">معلومات التوصيل</div>
    <div class="card-body">
      <div class="row g-3">
        <div class="col-md-6">
          <div class="p-3 bg-light rounded-3">
            <div class="text-muted small">رسوم التوصيل</div>
            <div class="fw-bold">{{ store.delivery_fee|iqd }}</div>
          </div>
        </div>
        <div class="col-md-6">
          <div class="p-3 bg-light rounded-3">
            <div class="text-muted small">زمن التوصيل</div>
            <div class="fw-bold">
              {% if store.delivery_time %}
                {{ store.delivery_time }}
              {% else %}
                {% if store.delivery_time_unit == 'day' %}{{ store.delivery_time_value|default:0 }} يوم{% else %}{{ store.delivery_time_value|default:0 }} ساعة{% endif %}
              {% endif %}
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="card border-0 shadow-sm mt-3">
    <div class="card-header">موقع المتجر</div>
    <div class="card-body">
      <div class="row g-3">
        <div class="col-md-6">
          <div class="p-3 bg-light rounded-3">
            <div class="text-muted small">العنوان</div>
            <div class="fw-bold">{{ store.address|default:"—" }}</div>
            {% if store.formatted_address %}
            <div class="text-muted mt-1">{{ store.formatted_address }}</div>
            {% endif %}
          </div>
        </div>
        <div class="col-md-6">
          <div class="p-3 bg-light rounded-3">
            <div class="text-muted small">الإحداثيات</div>
            {% if store.latitude and store.longitude %}
              <div class="d-flex align-items-center">
                <span class="fw-bold" dir="ltr">{{ store.latitude }}, {{ store.longitude }}</span>
                <a class="btn btn-sm btn-outline-success ms-2" target="_blank" href="https://www.google.com/maps?q={{ store.latitude }},{{ store.longitude }}">افتح على خرائط Google</a>
              </div>
            {% else %}
              <div class="text-muted">لم يتم تحديد الإحداثيات</div>
            {% endif %}
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
.btn-lg { padding: .6rem 1rem }
</style>
{% endblock %}
