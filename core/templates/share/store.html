{% extends 'base.html' %}
{% block content %}
<div class="container py-4" dir="rtl">
  {% if not order %}
  <div class="alert alert-danger">الرابط غير صالح أو منتهي الصلاحية</div>
  {% else %}
  <div class="row g-3">
    <div class="col-12 col-lg-6">
      <div class="card h-100">
        <div class="card-header bg-light">العميل</div>
        <div class="card-body">
          <p class="mb-2"><strong>الاسم:</strong> {{ order.user.get_full_name|default:order.user.username }}</p>
          <p class="mb-2"><strong>الهاتف:</strong> <a href="tel:{{ order.user.phone }}">{{ order.user.phone }}</a></p>
          <div class="d-flex flex-wrap gap-2">
            {% if cust_wa_url %}<a class="btn btn-success btn-sm" target="_blank" href="{{ cust_wa_url }}">واتساب</a>{% endif %}
            {% if maps_cust %}<a class="btn btn-outline-success btn-sm" target="_blank" href="{{ maps_cust }}">خرائط</a>{% endif %}
          </div>
        </div>
      </div>
    </div>

    <div class="col-12 col-lg-6">
      <div class="card h-100">
        <div class="card-header bg-light">المتجر</div>
        <div class="card-body">
          <p class="mb-2"><strong>الاسم:</strong> {{ order.store.name }}</p>
          <p class="mb-2"><strong>الهاتف:</strong> {% if order.store.owner_phone %}<a href="tel:{{ order.store.owner_phone }}">{{ order.store.owner_phone }}</a>{% elif order.store_phone %}<a href="tel:{{ order.store_phone }}">{{ order.store_phone }}</a>{% else %}—{% endif %}</p>
          <div class="d-flex flex-wrap gap-2">
            {% if store_wa_url %}<a class="btn btn-success btn-sm" target="_blank" href="{{ store_wa_url }}">واتساب</a>{% endif %}
            {% if maps_store %}<a class="btn btn-outline-success btn-sm" target="_blank" href="{{ maps_store }}">خرائط</a>{% endif %}
          </div>
        </div>
      </div>
    </div>

    <div class="col-12">
      <div class="card">
        <div class="card-header bg-light">الطلب</div>
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center mb-3">
            <div>
              <strong>رقم الطلب:</strong> #{{ order.id }}
            </div>
            <div>
              <span class="badge {% if order.status == 'pending' %}bg-warning text-dark{% elif order.status == 'accepted' %}bg-info{% elif order.status == 'packed' %}bg-primary{% elif order.status == 'preparing' or order.status == 'on_the_way' %}bg-secondary{% elif order.status == 'delivered' %}bg-success{% elif order.status == 'canceled' %}bg-danger{% endif %}">{{ order.get_status_display }}</span>
            </div>
          </div>
          <div class="table-responsive">
            <table class="table table-sm">
              <thead>
                <tr>
                  <th>المنتج</th>
                  <th>اللون</th>
                  <th>المقاس</th>
                  <th>الكمية</th>
                  <th>السعر</th>
                </tr>
              </thead>
              <tbody>
                {% for it in order.items.all %}
                <tr>
                  <td>{{ it.product.name }}</td>
                  <td>{% if it.variant %}{{ it.variant.color }}{% endif %}</td>
                  <td>{% if it.variant %}{{ it.variant.size }}{% endif %}</td>
                  <td>{{ it.quantity }}</td>
                  <td>{{ it.price|iqd }}</td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
          <div class="d-flex justify-content-between pt-2 border-top">
            <span class="fw-bold">الإجمالي:</span>
            <span class="fw-bold">{{ order.total_amount|iqd }}</span>
          </div>
        </div>
      </div>
    </div>
  </div>
  {% endif %}
</div>
{% endblock %}
